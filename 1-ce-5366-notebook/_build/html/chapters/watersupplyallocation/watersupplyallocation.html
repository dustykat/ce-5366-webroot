
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Water Supply Allocation under Uncertainty &#8212; Water Resources Management</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Water Quality Allocation" href="../waterqualityallocation/waterqualityallocation.html" />
    <link rel="prev" title="Non-Linear Programming for Decision Support" href="../decisionSupportbyNLP/nonlinearprograms.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/WRMlogo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Water Resources Management</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to CE-5366 Water Resources Manglement
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../introduction/introduction.html">
   Introduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../introduction/resourcesallocation.html">
     Resource Allocation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../economics/economics.html">
   Financial Planning and Management
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../economics/policyoverride.html">
     Policy Overrides
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../simulation/simulation.html">
   Modeling for Decision Support
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../optimization/optimization.html">
   Optimization Modeling for Decision Support
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../optimization/1topic.html">
     Scheduling Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../optimization/2topic.html">
     Grid Search Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../optimization/3topic.html">
     Steepest Descent
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../decisionSupportbyLP/linearprograms.html">
   Linear Programming for Decision Support
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../gwexample/gwexample.html">
   Groundwater Water Allocation by Simulation-Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../decisionSupportbyNLP/nonlinearprograms.html">
   Non-Linear Programming for Decision Support
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Water Supply Allocation under Uncertainty
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../waterqualityallocation/waterqualityallocation.html">
   Water Quality Allocation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../waterqualityallocation/reactortank.html">
     Example: Reactor-Tank System
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../qual2e/waterqualitymodels.html">
     Water Quality Simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../qual2e/qual2e.html">
     QUAL2
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/chapters/watersupplyallocation/watersupplyallocation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapters/watersupplyallocation/watersupplyallocation.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/chapters/watersupplyallocation/watersupplyallocation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-programming-model-framework">
   Linear Programming Model Framework
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#approximating-the-random-variable">
   Approximating the Random Variable
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#technological-and-probability-values">
   Technological and Probability Values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-programming-model-solution">
   Linear Programming Model Solution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="water-supply-allocation-under-uncertainty">
<h1>Water Supply Allocation under Uncertainty<a class="headerlink" href="#water-supply-allocation-under-uncertainty" title="Permalink to this headline">¶</a></h1>
<p>Introduction of uncertainty into an allocation problem creates a stochastic programming situation. There are a variety of methods to address stochastic programming, the next two examples illustrate a case where the problem is linear enough for a linear programming solution. Using LP for stochastic problems results in a large increase in the number of variables and constraints to account for alternative scenarios or in the use of chance constraints. These two approaches are explored in this chapter and the next – in this chapter we will examine two-stage linear programming by means of a simple example. The example will be repeated in the next chapter using a concept called “chance constraints”.</p>
<p>A water master for a region can divert water from an unregulated stream to three
consumers: a municipality, an industrial concern, and an agricultural concern. A
schematic of the system is shown in the sketch below:</p>
<p><img alt="" src="../../_images/diversionsketch.png" /></p>
<p>The industrial and agricultural concern are expanding and would like to know how
much water they can expect. If the water supply is insufficient, the expansion plans
will be curtailed.</p>
<p>The unregulated streamflow is a random variable, and the goal of the water master
is to maximize benefit to the water supply authority.
Let <span class="math notranslate nohighlight">\(T_i\)</span> represent the contracted quantity of water the supplier will deliver to each
user <span class="math notranslate nohighlight">\(i\)</span> (there are three in this example). If the water is delivered, the resulting net benefits to the local economy are
estimated to be <span class="math notranslate nohighlight">\(NB_i\)</span>. However, if the water is not delivered, water must be obtained from an alternate source, or demand must be curtailed by rationing of the municipal users, reduced production by industrial users, or reduced irrigation by the agricultural users. Such deficits reduce the net benefits to user <span class="math notranslate nohighlight">\(i\)</span> by a cost <span class="math notranslate nohighlight">\(C_i\)</span> per unit of water not supplied. Each user can provide the water master with an estimate of the maximum amount of water they can use, <span class="math notranslate nohighlight">\(T_{max}\)</span>.</p>
<p><span class="math notranslate nohighlight">\(Q\)</span>, the total water available, is a random variable described by some probability
distribution. The water master’s goal is to maximize the expected net benefit to the
region by allocating water to the three users.</p>
<div class="section" id="linear-programming-model-framework">
<h2>Linear Programming Model Framework<a class="headerlink" href="#linear-programming-model-framework" title="Permalink to this headline">¶</a></h2>
<p>Let the deficit for a delivery be denoted by the variable <span class="math notranslate nohighlight">\(D_{i,j}\)</span> , where the <span class="math notranslate nohighlight">\(i\)</span> subscript
refers to a particular user, and the <span class="math notranslate nohighlight">\(j\)</span> subscript refers to the particular random supply scenario.
The water masters allocation problem is then to maximize expected benefit. Recall
an expected cost (or benefit) is the product of the probability of an outcome and the value (cost) of the outcome.
In this example the benefits of the deliveries is assured (probability = 1), but the costs of the deficits are stochastic, hence the benefit function is:</p>
<div class="math notranslate nohighlight">
\[ NB = NB_{1} \cdot T_{1} + NB_{2} \cdot T_{2} + NB_{3} \cdot T_{3} - E(C_{1} \cdot D_{1,Q} + C_{2} \cdot D_{2,Q} + C_{3} \cdot D_{3,Q})\]</div>
<p>The constraints that are imposed are:</p>
<div class="math notranslate nohighlight">
\[ T_1 + T_2 + T_3 - [D_{1,Q} + D_{2,Q} + D_{3,Q}] \le Q\]</div>
<div class="math notranslate nohighlight">
\[ 0 \le T_i - D_{i,Q} \le T_i^{max} \]</div>
</div>
<div class="section" id="approximating-the-random-variable">
<h2>Approximating the Random Variable<a class="headerlink" href="#approximating-the-random-variable" title="Permalink to this headline">¶</a></h2>
<p>To approximate the value of the expectation, we can approximate the distribution of
Q with a discrete distribution as in the sketch below. For a continuous distribution, some
kind of discretization will be required to keep the LP manageable.</p>
<p><img alt="" src="../../_images/flowprob.png" /></p>
<p>We can obtain such an approximation by analysing the supply streamflow and use the <a class="reference external" href="https://pubs.er.usgs.gov/publication/wsp1542A">flow-duration curve</a> to postulate probability mass values for different flow rates (annualized or at least seasonalized).</p>
<p>The approximation allows the estimation of the expected cost (of failed delivery) to be manifest in the objective function, and the supply availability in the constraint set. The model in this instance (3 customers, 3 possible supply rates) has a total of 12 decision variables; the three contracted deliveries and nine deficits (from the 3
possible supply rates).</p>
<p>The cost function becomes:
$<span class="math notranslate nohighlight">\( NB = NB_{1} \cdot T_{1} + NB_{2} \cdot T_{2} + NB_{3} \cdot T_{3} ~~~~~ \\ - p_1(C_{1} \cdot D_{1,q_1} + C_{2} \cdot D_{2,q_1} + C_{3} \cdot D_{3,q_1}) \\ -p_2(C_{1} \cdot D_{1,q_2} + C_{2} \cdot D_{2,q_2} + C_{3} \cdot D_{3,q_2}) \\- p_3(C_{1} \cdot D_{1,q_3} + C_{2} \cdot D_{2,q_3} + C_{3} \cdot D_{3,q_3})\)</span>$
The constraint set becomes:</p>
<p><img alt="" src="../../_images/constraintset.png" /></p>
<p>The solution to this LP model would provide the water master with the optimal allocation of contracted (promised delivery) as well as an estimate (implicit in the solution) of the resource allocations to make when supply is insufficient.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The deliveries are actually fixed, the deficits are dependent on the flow state, if the expected failures are too large (too likely) we would want to renegotiate the contracts.</p>
</div>
</div>
<div class="section" id="technological-and-probability-values">
<h2>Technological and Probability Values<a class="headerlink" href="#technological-and-probability-values" title="Permalink to this headline">¶</a></h2>
<p>Assume for this example that the table below contains the unit benefits and unit penalty costs for the three uses and the maximum value that each user can assimilate.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>User</p></th>
<th class="head"><p>Index <span class="math notranslate nohighlight">\(i\)</span></p></th>
<th class="head"><p>$<span class="math notranslate nohighlight">\(NB_i\)</span>$</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(C_i\)</span></p></th>
<th class="text-align:right head"><p>$<span class="math notranslate nohighlight">\(T_i^{max}\)</span>$</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Municipal</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>100</p></td>
<td class="text-align:right"><p>250</p></td>
</tr>
<tr class="row-odd"><td><p>Industrial</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>50</p></td>
<td class="text-align:right"><p>75</p></td>
</tr>
<tr class="row-even"><td><p>Agricultural</p></td>
<td><p>3</p></td>
<td><p>5</p></td>
<td><p>30</p></td>
<td class="text-align:right"><p>60</p></td>
</tr>
</tbody>
</table>
<p>The streamflow flow-state distribution for the region (inferred from a flow duration curve) is.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Flow State <span class="math notranslate nohighlight">\(j\)</span></p></th>
<th class="head"><p>Value <span class="math notranslate nohighlight">\(q_j\)</span></p></th>
<th class="head"><p>Probability <span class="math notranslate nohighlight">\(p_j\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>4</p></td>
<td><p>0.20</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>10</p></td>
<td><p>0.60</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>17</p></td>
<td><p>0.20</p></td>
</tr>
</tbody>
</table>
<p>The values in these two tables are inserted into their representative locations in the
linear program structure (cost function and constraint set). Once these values are
supplied, then we have the necessary set-up for a Linear Program and can apply our
tools to its solution. So the linear program to be solved is depicted below</p>
<p><img alt="" src="../../_images/linearP.png" /></p>
</div>
<div class="section" id="linear-programming-model-solution">
<h2>Linear Programming Model Solution<a class="headerlink" href="#linear-programming-model-solution" title="Permalink to this headline">¶</a></h2>
<p>To solve the LP we need to translate the framework into a structure
for our solver tool to process. The process to solve the problem is to
build the cost function weights, then the constraint matrix coefficients, then the right
hand side, and finally the sense of the constraints. Once these are built, the objects
can be sent to the program for a solution.
For this example, the cost function unit values are hand-entered and the probabilities
are stored in a separate vector. The coefficient for the cost function is created by
element-by-element multiplication of the two vectors. The result is what will be sent
to the LP solver algorithm.
The coefficient matrix is constructed row-wise, again by hand. The right-hand-side
matrix is also hand constructed. The sense of the inequalities is constructed semi-
automatically by taking advantage of how the tableau is structured. Finally all the
elements are sent to the algorithm as shown in Listing 18 builds and solves the example
problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">NB1</span><span class="o">=</span><span class="mf">100.0</span>
<span class="n">NB2</span><span class="o">=</span><span class="mf">50.0</span>
<span class="n">NB3</span><span class="o">=</span><span class="mf">30.0</span>
<span class="n">C1</span><span class="o">=</span><span class="mf">250.0</span>
<span class="n">C2</span><span class="o">=</span><span class="mf">75.0</span>
<span class="n">C3</span><span class="o">=</span><span class="mf">60.0</span>
<span class="n">p1</span><span class="o">=</span><span class="mf">0.20</span>
<span class="n">p2</span><span class="o">=</span><span class="mf">0.60</span>
<span class="n">p3</span><span class="o">=</span><span class="mf">0.20</span>
<span class="n">q1</span><span class="o">=</span><span class="mf">4.0</span>
<span class="n">q2</span><span class="o">=</span><span class="mf">10.0</span>
<span class="n">q3</span><span class="o">=</span><span class="mf">17.0</span>
<span class="c1"># build a cost coefficient vector</span>
<span class="n">cost</span> <span class="o">=</span> <span class="p">[</span><span class="n">NB1</span><span class="p">,</span><span class="n">NB2</span><span class="p">,</span><span class="n">NB3</span><span class="p">,</span><span class="o">-</span><span class="n">C1</span><span class="p">,</span><span class="o">-</span><span class="n">C2</span><span class="p">,</span><span class="o">-</span><span class="n">C3</span><span class="p">,</span><span class="o">-</span><span class="n">C1</span><span class="p">,</span><span class="o">-</span><span class="n">C2</span><span class="p">,</span><span class="o">-</span><span class="n">C3</span><span class="p">,</span><span class="o">-</span><span class="n">C1</span><span class="p">,</span><span class="o">-</span><span class="n">C2</span><span class="p">,</span><span class="o">-</span><span class="n">C3</span><span class="p">]</span>  <span class="c1">#cost coefficient vector </span>
<span class="n">prob</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mf">0.2</span> <span class="p">,</span><span class="mf">0.2</span> <span class="p">,</span><span class="mf">0.2</span> <span class="p">,</span><span class="mf">0.6</span> <span class="p">,</span><span class="mf">0.6</span> <span class="p">,</span><span class="mf">0.6</span> <span class="p">,</span><span class="mf">0.2</span> <span class="p">,</span><span class="mf">0.2</span> <span class="p">,</span><span class="mf">0.2</span><span class="p">]</span> <span class="c1">#probability mass vector - the ones are for the Target deliveries</span>
<span class="n">prices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="c1"># this is our cost coefficient vector</span>
<span class="c1"># build the constraint set</span>
<span class="c1"># Build the constraint RHS vector (SciPy uses less-than for inequality)</span>
<span class="c1">#</span>
<span class="c1"># constraint matrix</span>
<span class="n">constraint</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">irow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span> <span class="k">for</span> <span class="n">jcol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">21</span><span class="p">)])</span> <span class="p">;</span>
<span class="c1"># manual build by row</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">0</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">1</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">2</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">3</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">4</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">5</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">6</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">7</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">8</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">9</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">10</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">11</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">constraint</span> <span class="p">[</span><span class="mi">12</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">13</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">14</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">15</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">16</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">17</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">18</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">19</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">constraint</span> <span class="p">[</span><span class="mi">20</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        
<span class="n">rhs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span> <span class="p">,</span><span class="mi">10</span> <span class="p">,</span><span class="mi">14</span> <span class="p">,</span><span class="mi">2</span> <span class="p">,</span><span class="mi">3</span> <span class="p">,</span><span class="mi">5</span> <span class="p">,</span><span class="mi">2</span> <span class="p">,</span><span class="mi">3</span> <span class="p">,</span><span class="mi">5</span> <span class="p">,</span><span class="mi">2</span> <span class="p">,</span><span class="mi">3</span> <span class="p">,</span><span class="mi">5</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#  Change sense of greater-than constraints, so change sign </span>
<span class="k">for</span> <span class="n">irow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
    <span class="n">rhs</span><span class="p">[</span><span class="n">irow</span><span class="p">]</span><span class="o">=-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">rhs</span><span class="p">[</span><span class="n">irow</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">jcol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
        <span class="n">constraint</span><span class="p">[</span><span class="n">irow</span><span class="p">][</span><span class="n">jcol</span><span class="p">]</span><span class="o">=-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">constraint</span><span class="p">[</span><span class="n">irow</span><span class="p">][</span><span class="n">jcol</span><span class="p">]</span>

<span class="c1"># Change sense of prices (solver minimizes only)</span>
<span class="k">for</span> <span class="n">jcol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">prices</span><span class="p">[</span><span class="n">jcol</span><span class="p">]</span><span class="o">=-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">prices</span><span class="p">[</span><span class="n">jcol</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">linprog</span> <span class="c1"># load the package</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myoptions</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span><span class="s2">&quot;tol&quot;</span><span class="p">:</span> <span class="mf">1e-9</span><span class="p">,</span><span class="s2">&quot;autoscale&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
<span class="c1">#myoptions</span>
<span class="c1">#prices</span>
<span class="n">constraint</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1,  1,  1, -1, -1, -1,  0,  0,  0,  0,  0,  0],
       [ 1,  1,  1,  0,  0,  0, -1, -1, -1,  0,  0,  0],
       [ 1,  1,  1,  0,  0,  0,  0,  0,  0, -1, -1, -1],
       [ 1,  0,  0, -1,  0,  0,  0,  0,  0,  0,  0,  0],
       [ 0,  1,  0,  0, -1,  0,  0,  0,  0,  0,  0,  0],
       [ 0,  0,  1,  0,  0, -1,  0,  0,  0,  0,  0,  0],
       [ 1,  0,  0,  0,  0,  0, -1,  0,  0,  0,  0,  0],
       [ 0,  1,  0,  0,  0,  0,  0, -1,  0,  0,  0,  0],
       [ 0,  0,  1,  0,  0,  0,  0,  0, -1,  0,  0,  0],
       [ 1,  0,  0,  0,  0,  0,  0,  0,  0, -1,  0,  0],
       [ 0,  1,  0,  0,  0,  0,  0,  0,  0,  0, -1,  0],
       [ 0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0, -1],
       [-1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0],
       [ 0, -1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0],
       [ 0,  0, -1,  0,  0,  1,  0,  0,  0,  0,  0,  0],
       [-1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0],
       [ 0, -1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0],
       [ 0,  0, -1,  0,  0,  0,  0,  0,  1,  0,  0,  0],
       [-1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0],
       [ 0, -1,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0],
       [ 0,  0, -1,  0,  0,  0,  0,  0,  0,  0,  0,  1]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bnd</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span> <span class="c1"># set bounds 0-infnty</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">opt</span> <span class="o">=</span> <span class="n">linprog</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">prices</span><span class="p">,</span> <span class="n">A_ub</span><span class="o">=</span><span class="n">constraint</span><span class="p">,</span> <span class="n">b_ub</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnd</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;interior-point&quot;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="n">myoptions</span><span class="p">)</span>
<span class="c1">#opt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check for solution</span>
<span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimal Solution Found&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cost : &#39;</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="nb">round</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">irow</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target Delivery&#39;</span><span class="p">,</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; = &#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">irow</span><span class="o">=</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Streamflow State 1&quot;</span><span class="p">)</span>
    <span class="n">irow</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Defecit Delivery&#39;</span><span class="p">,</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; = &#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">irow</span><span class="o">=</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Streamflow State 2&quot;</span><span class="p">)</span>
    <span class="n">irow</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Defecit Delivery&#39;</span><span class="p">,</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; = &#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">irow</span><span class="o">=</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Streamflow State 3&quot;</span><span class="p">)</span>
    <span class="n">irow</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Defecit Delivery&#39;</span><span class="p">,</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; = &#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">irow</span><span class="o">=</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimal Solution Found
Cost :  425.0
Target Delivery 1  =  2.0
Target Delivery 2  =  3.0
Target Delivery 3  =  5.0
Streamflow State 1
Defecit Delivery 1  =  0.0
Defecit Delivery 2  =  1.0
Defecit Delivery 3  =  5.0
Streamflow State 2
Defecit Delivery 1  =  0.0
Defecit Delivery 2  =  0.0
Defecit Delivery 3  =  0.0
Streamflow State 3
Defecit Delivery 1  =  0.0
Defecit Delivery 2  =  0.0
Defecit Delivery 3  =  0.0
</pre></div>
</div>
</div>
</div>
<p>Once the script run, the output then needs to be interpreted - in the example above, the output is parsed using scripting and our knowledge of the problem structure.</p>
<p>The optimal solution is to contract deliveries to each user at the full amount they request. The expected net benefit is 425 benefit units. There is a 20% chance that users 2 and 3 will have deficits and the water master will incur costs. There is an 80% chance that all users will get their contracted water, and a 20% chance that there will be excess water available. If the system had storage the 20% excess cases could be used to help satisfy the one case when the system does not have enough input.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hmmm have just justified dam building!</p>
</div>
<p>A useful collateral result is that when the water input is too small to satisfy all the contracts, the solution also suggests how to make the allocations in the limited case – the municipal users are supplied their full amount, industry receives the remainder of the available water (and incurs a deficit of 1 unit), and agriculture is denied its entire request. The allocations would change if the unit benefits reflected the value of the water differently to the three users and/or the deficit costs changed.</p>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Determine the required penalty to ensure at least 1 unit of water is delivered to the agricultural sector Interpret the results of your solution.</p></li>
<li><p>Suppose there is a fourth user, the in-stream requirement to ensure health of the stream itself. If the in-stream requirement is 1 flow unit, how does the allocation change for the original problem and for the cost-incentivized agricultural adjustment? Document the new LP to accommodate the 4th user.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The objective function is cast in a penalty-function structure, and can be used to determine
costs to assign to produce economically influenced results.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters/watersupplyallocation"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../decisionSupportbyNLP/nonlinearprograms.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Non-Linear Programming for Decision Support</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../waterqualityallocation/waterqualityallocation.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Water Quality Allocation</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Theodore G. Cleveland, Ph.D., P.E., M.ASCE, F.EWRI.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>